(function(n){n.fn.maskMoney=function(t){return t=n.extend({symbol:"US$",showSymbol:!1,symbolStay:!1,thousands:",",decimal:".",precision:2,defaultZero:!0,allowZero:!1,allowNegative:!1},t),this.each(function(){function u(){e=!0}function h(){e=!1}function c(t){var r;if((t=t||window.event,r=t.charCode||t.keyCode||t.which,r==undefined)||i.attr("readonly")&&r!=13&&r!=9)return!1;if(r<48||r>57)return r==45?(u(),i.val(w(i)),!1):r==43?(u(),i.val(i.val().replace("-","")),!1):r==13||r==9?(e&&(h(),n(this).change()),!0):r==37||r==39?!0:(o(t),!0);if(i.val().length>=i.attr("maxlength"))return!1;o(t);var a=String.fromCharCode(r),f=i.get(0),c=i.getInputSelection(f),l=c.start,v=c.end;return f.value=f.value.substring(0,l)+a+f.value.substring(v,f.value.length),s(f,l+1),u(),!1}function v(t){var c;if((t=t||window.event,c=t.charCode||t.keyCode||t.which,c==undefined)||i.attr("readonly")&&c!=13&&c!=9)return!1;var r=i.get(0),a=i.getInputSelection(r),f=a.start,l=a.end;return c==8?(o(t),f==l?(r.value=r.value.substring(0,f-1)+r.value.substring(l,r.value.length),f=f-1):r.value=r.value.substring(0,f)+r.value.substring(l,r.value.length),s(r,f),u(),!1):c==9?(e&&(n(this).change(),h()),!0):c==46||c==63272?(o(t),r.value=r.selectionStart==r.selectionEnd?r.value.substring(0,f)+r.value.substring(l+1,r.value.length):r.value.substring(0,f)+r.value.substring(l,r.value.length),s(r,f),u(),!1):!0}function y(){var u=f(),n;i.val()==u?i.val(""):i.val()==""&&t.defaultZero?i.val(r(u)):i.val(r(i.val())),this.createTextRange&&(n=this.createTextRange(),n.collapse(!1),n.select())}function l(u){n.browser.msie&&c(u),i.val()==""||i.val()==r(f())||i.val()==t.symbol?t.allowZero?t.symbolStay?i.val(r(f())):i.val(f()):i.val(""):t.symbolStay?t.symbolStay&&i.val()==t.symbol&&i.val(r(f())):i.val(i.val().replace(t.symbol,""))}function o(n){n.preventDefault?n.preventDefault():n.returnValue=!1}function s(n,t){var u=i.val().length,r;i.val(a(n.value)),r=i.val().length,t=t-(u-r),i.setCursorPosition(t)}function a(n){var u,f,o,h;n=n.replace(t.symbol,"");var e=n.length,c="",i="",s="";if(e!=0&&n.charAt(0)=="-"&&(n=n.replace("-",""),t.allowNegative&&(s="-")),e==0){if(!t.defaultZero)return i;i="0.00"}for(u=0;u<e;u++)if(n.charAt(u)!="0"&&n.charAt(u)!=t.decimal)break;for(;u<e;u++)"0123456789".indexOf(n.charAt(u))!=-1&&(c+=n.charAt(u));for(f=parseFloat(c),f=isNaN(f)?0:f/Math.pow(10,t.precision),i=f.toFixed(t.precision),u=t.precision==0?0:1,h=(i=i.split("."))[u].substr(0,t.precision),o=(i=i[0]).length;(o-=3)>=1;)i=i.substr(0,o)+t.thousands+i.substr(o);return t.precision>0?r(s+i+t.decimal+h+Array(t.precision+1-h.length).join(0)):r(s+i)}function p(){var n=i.val();i.val(a(n))}function f(){var n=parseFloat("0")/Math.pow(10,t.precision);return n.toFixed(t.precision).replace(new RegExp("\\.","g"),t.decimal)}function r(n){return t.showSymbol&&n.substr(0,t.symbol.length)!=t.symbol?t.symbol+n:n}function w(n){if(t.allowNegative){var i=n.val();return n.val()!=""&&n.val().charAt(0)=="-"?n.val().replace("-",""):"-"+n.val()}return n.val()}var i=n(this),e=!1;i.bind("keypress.maskMoney",c),i.bind("keydown.maskMoney",v),i.bind("blur.maskMoney",l),i.bind("focus.maskMoney",y),i.bind("mask",p);i.one("unmaskMoney",function(){i.unbind(".maskMoney"),n.browser.msie?this.onpaste=null:n.browser.mozilla&&this.removeEventListener("input",l,!1)})})},n.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")},n.fn.mask=function(){return this.trigger("mask")},n.fn.setCursorPosition=function(n){return this.each(function(t,i){if(i.setSelectionRange)i.focus(),i.setSelectionRange(n,n);else if(i.createTextRange){var r=i.createTextRange();r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",n),r.select()}}),this},n.fn.getInputSelection=function(n){var t=0,r=0,o,f,i,u,e;return typeof n.selectionStart=="number"&&typeof n.selectionEnd=="number"?(t=n.selectionStart,r=n.selectionEnd):(f=document.selection.createRange(),f&&f.parentElement()==n&&(u=n.value.length,o=n.value.replace(/\r\n/g,"\n"),i=n.createTextRange(),i.moveToBookmark(f.getBookmark()),e=n.createTextRange(),e.collapse(!1),i.compareEndPoints("StartToEnd",e)>-1?t=r=u:(t=-i.moveStart("character",-u),t+=o.slice(0,t).split("\n").length-1,r=i.compareEndPoints("EndToEnd",e)>-1?u:-i.moveEnd("character",-u)+(o.slice(0,r).split("\n").length-1)))),{start:t,end:r}}})(jQuery)