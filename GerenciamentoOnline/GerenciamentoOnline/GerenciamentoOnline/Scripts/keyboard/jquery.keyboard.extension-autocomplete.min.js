(function(n){"use strict";n.fn.addAutocomplete=function(){return this.each(function(){var t=n(this).data("keyboard");t&&(t.autocomplete_new_version=function(n){return n[0]=parseInt(n[0],10),n[0]>1||n[0]===1&&parseInt(n[1],10)>=9}(n.ui.version.split(".")),t.autocomplete_init=function(){t.options.alwaysOpen&&t.isVisible()&&t.autocomplete_setup(),t.$el.bind("visible.keyboard",function(){t.autocomplete_setup()}).bind("change.keyboard",function(){t.hasAutocomplete&&t.isVisible()&&t.$el.val(t.$preview.val()).trigger("keydown.autocomplete")}).bind("hidden.keyboard",function(){t.$el.autocomplete("close")}).bind("autocompleteopen",function(){t.hasAutocomplete&&t.$autocomplete.menu.element.position({of:t.$keyboard,my:"right top",at:"left top",collision:"flip"})}).bind("autocompleteselect",function(n,i){var r=i.item.value;t.hasAutocomplete&&r!==""&&(t.$preview.val(r).focus(),t.lastCaret={start:r.length,end:r.length})})},t.autocomplete_setup=function(){t.$autocomplete=t.$el.data("autocomplete")||t.$el.data("uiAutocomplete"),t.hasAutocomplete=typeof t.$autocomplete=="undefined"?!1:t.$autocomplete.options.disabled?!1:!0,t.hasAutocomplete&&!t.autocomplete_bind&&(t.$preview.bind("keydown",function(n){return t.autocomplete_input(n)}),t.$allKeys.bind("mouseup  mousedown mouseleave touchstart touchend touchcancel",function(n){t.autocomplete_input(n)}),t.autocomplete_bind=!0)},t.autocomplete_input=function(i){var u,r=n.ui.keyCode;switch(i.keyCode){case r.PAGE_UP:t.$autocomplete._move("previousPage",i),i.preventDefault();break;case r.PAGE_DOWN:t.$autocomplete._move("nextPage",i),i.preventDefault();break;case r.UP:t.$autocomplete._move("previous",i),i.preventDefault();break;case r.DOWN:t.$autocomplete._move("next",i),i.preventDefault();break;case r.ENTER:case r.NUMPAD_ENTER:u=t.$autocomplete.menu.element.find("#ui-active-menuitem,.ui-state-focus").text()||"",u!==""&&t.$preview.val(u),t.autocomplete_new_version&&t.$autocomplete.menu.select(i);break;default:clearTimeout(t.$autocomplete.searching),t.$autocomplete.searching=setTimeout(function(){t.$autocomplete.term!==t.$autocomplete.element.val()&&(t.$autocomplete.selectedItem=null,t.$autocomplete.search(null,i))},t.$autocomplete.options.delay)}},t.origEscClose=t.escClose,t.escClose=function(i){t.hasAutocomplete&&(i.target.id==="ui-active-menuitem"||n(i.target).closest("ul").hasClass("ui-autocomplete"))||t.origEscClose(i)},t.autocomplete_init())})}})(jQuery)