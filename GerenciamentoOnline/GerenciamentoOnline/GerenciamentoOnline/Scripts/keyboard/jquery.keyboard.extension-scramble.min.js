(function(n){"use strict";n.keyboard=n.keyboard||{},n.fn.addScramble=function(t){var i={targetKeys:/[a-z\d]/i,byRow:!0,randomizeOnce:!0};return this.each(function(){var u,r=n(this).data("keyboard");r&&(u=r.scramble_options=n.extend({},i,t),r.scramble_setup=function(t){var y,v,c,e,l,o,f,h,a,s,i;if((!r.randomizeOnce||!r.randomizeComplete)&&(y=t.find(".ui-keyboard-keyset"),t.length)){for(v=0;v<y.length;v++)if(c=y.eq(v),f=0,i=[],a=[],h=[],s=[],c.find("button, br").each(function(){this.tagName==="BR"?u.byRow?(i.push(this),a.push(!1),s[f]=i,h[f]=a,i=[],a=[],f++):(s[f]=this,h[f]=!1,f++):(o=n(this).attr("data-value")||"",o=o.length===1&&u.targetKeys.test(o)?o:!1,u.byRow?(i.push(this),a.push(o)):(s[f]=this,h[f]=o,f++))}),c.find(".ui-keyboard-button-endrow").remove(),u.byRow)for(l=0;l<s.length;l++)for(i=r.shuffle(s[l],h[l]),e=0;e<i.length;e++)c.append(i[e]);else for(i=r.shuffle(s,h),e=0;e<i.length;e++)c.append(i[e]);return r.randomizeOnce||r.randomizeComplete||r.$el.bind("beforeVisible.keyboard",function(){r.rescramble&&(r.$keyboard=r.scramble_setup(r.$keyboard)),r.rescramble=!0}),r.randomizeComplete=!0,t}},r.shuffle=function(n,t){for(var u,r,i=n.length;i>0;)r=Math.floor(Math.random()*i),t[i-1]===!1&&i--,t[i-1]!==!1&&t[r]!==!1&&(i--,u=n[i],n[i]=n[r],n[r]=u);return n},r.options.create=function(){var n=r.buildKeyboard();return r.scramble_setup(n)})})}})(jQuery)