(function(n){"use strict";n.keyboard=n.keyboard||{},n.keyboard.navigationKeys={toggle:112,enter:13,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40},n.fn.addNavigation=function(t){return this.each(function(){var r,u,i=n(this).data("keyboard");i&&(i.navigation_options=r=n.extend({},{position:[0,0],toggleMode:!1,focusClass:"hasFocus"},t),i.navigation_keys=u=n.extend({},n.keyboard.navigationKeys),i.saveNav=[i.options.tabNavigation,i.options.enterNavigation],i.allNavKeys=n.map(u,function(n){return n}),i.navigation_init=function(){i.$keyboard[r.toggleMode?"addClass":"removeClass"](r.focusClass).find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+r.position[0]+","+r.position[1]+'"]').addClass("ui-state-hover"),i.$preview.unbind("keydown.keyboardNav").bind("keydown.keyboardNav",function(n){return i.checkKeys(n.which)})},i.checkKeys=function(t,u){if(typeof t!="undefined"){var f=i.navigation_keys;return((t===f.toggle||u)&&(r.toggleMode=u?!1:!r.toggleMode,i.options.tabNavigation=r.toggleMode?!1:i.saveNav[0],i.options.enterNavigation=r.toggleMode?!1:i.saveNav[1]),i.$keyboard[r.toggleMode?"addClass":"removeClass"](r.focusClass),r.toggleMode&&t===f.enter)?(i.$keyboard.find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+r.position[0]+","+r.position[1]+'"]').trigger("repeater.keyboard"),!1):r.toggleMode&&n.inArray(t,i.allNavKeys)>=0?(i.navigateKeys(t),!1):void 0}},i.navigateKeys=function(n,t,u){u=u||r.position[1],t=t||r.position[0];var e=i.$keyboard.find(".ui-keyboard-keyset:visible"),s=e.find(".ui-keyboard-button-endrow").length-1,o=e.find('.ui-keyboard-button[data-pos^="'+t+',"]').length-1,f=i.navigation_keys;switch(n){case f.pageup:t=0;break;case f.pagedown:t=s;break;case f.end:u=o;break;case f.home:u=0;break;case f.left:u+=u>0?-1:0;break;case f.up:t+=t>0?-1:0;break;case f.right:u+=1;break;case f.down:t+=t+1>s?0:1}o=e.find('.ui-keyboard-button[data-pos^="'+t+',"]').length-1,u>o&&(u=o),e.find(".ui-state-hover").removeClass("ui-state-hover"),e.find('.ui-keyboard-button[data-pos="'+t+","+u+'"]').addClass("ui-state-hover"),r.position=[t,u]},i.options.alwaysOpen&&i.isVisible&&(i.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover"),i.navigation_init()),i.$el.bind("visible.keyboard",function(){i.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover"),i.navigation_init()}).bind("inactive.keyboard hidden.keyboard",function(n){i.checkKeys(n.which,!0)}).bind("navigate navigateTo",function(n,t,r){t=isNaN(t)?t.toLowerCase():t,i.navigation_keys.hasOwnProperty(t)?i.checkKeys(i.navigation_keys[t]):i.navigateKeys(null,t,r)}))})}})(jQuery)