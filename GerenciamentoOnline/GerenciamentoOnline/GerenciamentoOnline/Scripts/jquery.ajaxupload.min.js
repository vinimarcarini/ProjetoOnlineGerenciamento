(function(){function n(n,t,i){if(n.addEventListener)n.addEventListener(t,i,!1);else if(n.attachEvent)n.attachEvent("on"+t,function(){i.call(n)});else throw new Error("not supported or DOM not loaded");}function c(n){var t,u,i,f,e=r(n);return t=e.left,i=e.top,u=t+n.offsetWidth,f=i+n.offsetHeight,{left:t,right:u,top:i,bottom:f}}function u(n,t){for(var i in t)t.hasOwnProperty(i)&&(n.style[i]=t[i])}function l(n,t){var i=c(n);u(t,{position:"absolute",left:i.left+"px",top:i.top+"px",width:n.offsetWidth+"px",height:n.offsetHeight+"px"})}function s(n){return n.replace(/.*(\/|\\)/,"")}function h(n){return-1!==n.indexOf(".")?n.replace(/.*[.]/,""):""}function a(n,t){var i=new RegExp("\\b"+t+"\\b");return i.test(n.className)}function e(n,t){a(n,t)||(n.className+=" "+t)}function t(n,t){var i=new RegExp("\\b"+t+"\\b");n.className=n.className.replace(i,"")}function i(n){n.parentNode.removeChild(n)}var r,f,o;r=document.documentElement.getBoundingClientRect?function(n){var f=n.getBoundingClientRect(),e=n.ownerDocument,i=e.body,r=e.documentElement,o=r.clientTop||i.clientTop||0,s=r.clientLeft||i.clientLeft||0,t=1,u,h,c;return i.getBoundingClientRect&&(u=i.getBoundingClientRect(),t=(u.right-u.left)/i.clientWidth),t>1&&(o=0,s=0),h=f.top/t+(window.pageYOffset||r&&r.scrollTop/t||i.scrollTop/t)-o,c=f.left/t+(window.pageXOffset||r&&r.scrollLeft/t||i.scrollLeft/t)-s,{top:h,left:c}}:function(n){var t=0,i=0;do t+=n.offsetTop||0,i+=n.offsetLeft||0,n=n.offsetParent;while(n);return{left:i,top:t}},f=function(){var n=document.createElement("div");return function(t){n.innerHTML=t;var i=n.firstChild;return n.removeChild(i)}}(),o=function(){var n=0;return function(){return"ValumsAjaxUpload"+n++}}(),window.AjaxUpload=function(t,i){this._settings={action:"upload.php",name:"userfile",multiple:!1,data:{},autoSubmit:!0,responseType:!1,hoverClass:"hover",focusClass:"focus",disabledClass:"disabled",onChange:function(){},onSubmit:function(){},onComplete:function(){}};for(var r in i)i.hasOwnProperty(r)&&(this._settings[r]=i[r]);if(t.jquery?t=t[0]:typeof t=="string"&&(/^#.*/.test(t)&&(t=t.slice(1)),t=document.getElementById(t)),!t||t.nodeType!==1)throw new Error("Please make sure that you're passing a valid element");t.nodeName.toUpperCase()=="A"&&n(t,"click",function(n){n&&n.preventDefault?n.preventDefault():window.event&&(window.event.returnValue=!1)}),this._button=t,this._input=null,this._disabled=!1,this.enable(),this._rerouteClicks()},AjaxUpload.prototype={setData:function(n){this._settings.data=n},disable:function(){e(this._button,this._settings.disabledClass),this._disabled=!0;var n=this._button.nodeName.toUpperCase();(n=="INPUT"||n=="BUTTON")&&this._button.setAttribute("disabled","disabled"),this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){t(this._button,this._settings.disabledClass),this._button.removeAttribute("disabled"),this._disabled=!1},_createInput:function(){var r=this,i=document.createElement("input"),f;if(i.setAttribute("type","file"),i.setAttribute("name",this._settings.name),this._settings.multiple&&i.setAttribute("multiple","multiple"),u(i,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"}),f=document.createElement("div"),u(f,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583}),f.style.opacity!=="0"){if(typeof f.filters=="undefined")throw new Error("Opacity not supported by the browser");f.style.filter="alpha(opacity=0)"}n(i,"change",function(){if(i&&i.value!==""){var n=s(i.value);if(!1===r._settings.onChange.call(r,n,h(n))){r._clearInput();return}r._settings.autoSubmit&&r.submit()}}),n(i,"mouseover",function(){e(r._button,r._settings.hoverClass)}),n(i,"mouseout",function(){t(r._button,r._settings.hoverClass),t(r._button,r._settings.focusClass),i.parentNode&&(i.parentNode.style.visibility="hidden")}),n(i,"focus",function(){e(r._button,r._settings.focusClass)}),n(i,"blur",function(){t(r._button,r._settings.focusClass)}),f.appendChild(i),document.body.appendChild(f),this._input=i},_clearInput:function(){this._input&&(i(this._input.parentNode),this._input=null,this._createInput(),t(this._button,this._settings.hoverClass),t(this._button,this._settings.focusClass))},_rerouteClicks:function(){var t=this;n(t._button,"mouseover",function(){if(!t._disabled){t._input||t._createInput();var n=t._input.parentNode;l(t._button,n),n.style.visibility="visible"}})},_createIframe:function(){var t=o(),n=f('<iframe src="javascript:false;" name="'+t+'" />');return n.setAttribute("id",t),n.style.display="none",document.body.appendChild(n),n},_createForm:function(n){var r=this._settings,t=f('<form method="post" enctype="multipart/form-data"><\/form>'),u,i;t.setAttribute("action",r.action),t.setAttribute("target",n.name),t.style.display="none",document.body.appendChild(t);for(u in r.data)r.data.hasOwnProperty(u)&&(i=document.createElement("input"),i.setAttribute("type","hidden"),i.setAttribute("name",u),i.setAttribute("value",r.data[u]),t.appendChild(i));return t},_getResponse:function(t,r){var f=!1,e=this,u=this._settings;n(t,"load",function(){var n,o;if(t.src=="javascript:'%3Chtml%3E%3C/html%3E';"||t.src=="javascript:'<html><\/html>';"){f&&setTimeout(function(){i(t)},0);return}(n=t.contentDocument?t.contentDocument:window.frames[t.id].document,n.readyState&&n.readyState!="complete")||n.body&&n.body.innerHTML=="false"||(n.XMLDocument?o=n.XMLDocument:n.body?(o=n.body.innerHTML,u.responseType&&u.responseType.toLowerCase()=="json"&&(n.body.firstChild&&n.body.firstChild.nodeName.toUpperCase()=="PRE"&&(n.normalize(),o=n.body.firstChild.firstChild.nodeValue),o=o?eval("("+o+")"):{})):o=n,u.onComplete.call(e,r,o),f=!0,t.src="javascript:'<html><\/html>';")})},submit:function(){var r=this,e=this._settings,u,f,n;if(this._input&&this._input.value!==""){if(u=s(this._input.value),!1===e.onSubmit.call(this,u,h(u))){this._clearInput();return}f=this._createIframe(),n=this._createForm(f),i(this._input.parentNode),t(r._button,r._settings.hoverClass),t(r._button,r._settings.focusClass),n.appendChild(this._input),n.submit(),i(n),n=null,i(this._input),this._input=null,this._getResponse(f,u),this._createInput()}}}})()